<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Javascriptでブロック崩し - js do it</title>
<meta name="Description" content="" />
<meta name="Keywords"  content="" />

<link rel="stylesheet" type="text/css" media="screen,print" href="style.css" />
</head>
<body>
<!-- generated by: jsdo.it - http://jsdo.it/naoyashiga/jR2i -->
<!-- Copyright naoyashiga - http://jsdo.it/naoyashiga -->
<!-- Licensed under MIT License - http://www.opensource.org/licenses/mit-license.php -->
<script type="text/javascript" src="http://jsrun.it/assets/1/X/K/K/1XKKp"></script>
<script type="text/paperscript" canvas="myCanvas">
var brickWidth = view.size.width / 12,//レンガの横幅
    brickHeight = view.size.height / 48,//レンガの縦幅
    rows = 10,//レンガを並べる行数
    cols = 10,//レンガを並べる列数
    xMargin = 3,//レンガ同士のX方向の間隔
    yMargin = 3,//レンガ同士のY方向の間隔
    bulletRadius = 8,//弾丸の半径
    vx = 3,//弾丸のX方向の速度
    vy = 6;//弾丸のY方向の速度

/*-----------------------------------
    レンガ
-----------------------------------*/
//レンガを作成
var brick = new Rectangle();
brick.size = new Size(brickWidth, brickHeight);

//レンガのパス
var path = new Path.Rectangle(brick);
path.fillColor = '#444';

//レンガをシンボル化
var symbol = new Symbol(path);

//レンガを並べる
for(var y = 0;y < rows;y++){
    for(var x = 0;x < cols;x++){
        var center = new Point(x, y) * [brick.size.width + xMargin,brick.size.height + yMargin];
        var placedSymbol = symbol.place(center);
    }
}
//レンガのレイヤーを中央に移動
project.activeLayer.position = [view.size.width / 2,view.size.height / 4];

/*-----------------------------------
    レイヤー構成
    -レイヤー0
    --レンガ
    -レイヤー1
    --弾丸
    --プレイヤー
-----------------------------------*/
//レイヤー1を新規作成
var secondLayer = new Layer();
//レイヤー0のレンガを取得
var brickChildren = project.layers[0].children;

/*-----------------------------------
    弾丸
-----------------------------------*/
var bullet = new Path.Circle({
    center:[view.size.width / 2,view.size.height - 50],
    radius:bulletRadius,
    fillColor:"#f39c12"
});

/*-----------------------------------
    プレイヤー(バー)
-----------------------------------*/
var playerRect = new Rectangle();
playerRect.size = new Size(100, 10);
playerRect.center = new Point(view.size.width / 2,view.size.height - 50);

var player = new Path.Rectangle(playerRect);
player.fillColor = '#444';

/*-----------------------------------
    マウスの動きに合わせてプレイヤーが移動
-----------------------------------*/
function onMouseMove(event){
    player.position.x = event.point.x;
    //垂直方向の壁
    if(player.bounds.left < 0){//左の壁
        player.position.x = player.bounds.width / 2;
    }else if(player.bounds.right > view.size.width){//右の壁
        player.position.x = view.size.width - player.bounds.width / 2;
    }
}

function onFrame(event){
    //弾丸の移動
    bullet.position.x += vx;
    bullet.position.y -= vy;
    
    //垂直方向の壁に対する弾丸の跳ね返り
    if(bullet.bounds.left < 0 || bullet.bounds.right > view.size.width){
            vx *= -1;  
    }
    
    //水平方向の壁に対する弾丸の跳ね返り
    if(bullet.bounds.top < 0 || bullet.bounds.bottom > view.size.height){
            vy *= -1;  
    }
    
    //プレイヤーに対する弾丸の当たり判定
    var hitResult = player.hitTest(bullet.bounds.bottomCenter);
    
    if(hitResult){
        if(hitResult.type == "fill"){
            //跳ね返る
            vy *= -1;
        }
    }
    
    //レンガに対する弾丸の当たり判定
    for(var i = 0;i < brickChildren.length;i++){
        var hitResult2 = brickChildren[i].hitTest(bullet.position);
        if(hitResult2){
            //跳ね返る
            vy *= -1;
            //レンガ消滅
            brickChildren[i].remove();
        }
    }
}
</script>
<canvas id="myCanvas" resize></canvas>

<script type="text/javascript" src="index.js"></script>
</body>
</html>
